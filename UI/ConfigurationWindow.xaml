<Window x:Class="A3sist.UI.ConfigurationWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="A3sist Configuration" 
        Height="700" 
        Width="900"
        MinHeight="600"
        MinWidth="800"
        WindowStartupLocation="CenterOwner"
        Icon="/A3sist;component/A3sist.ico">
    
    <Window.Resources>
        <Style x:Key="TabItemStyle" TargetType="TabItem">
            <Setter Property="Padding" Value="12,8"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
        </Style>
        
        <Style x:Key="SectionHeaderStyle" TargetType="TextBlock">
            <Setter Property="FontSize" Value="16"/>
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="Margin" Value="0,0,0,10"/>
            <Setter Property="Foreground" Value="#0078D4"/>
        </Style>
        
        <Style x:Key="ConfigButtonStyle" TargetType="Button">
            <Setter Property="Padding" Value="12,6"/>
            <Setter Property="Margin" Value="5"/>
            <Setter Property="MinWidth" Value="100"/>
        </Style>
    </Window.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Main content with tabs -->
        <TabControl Grid.Row="0" Margin="10">
            <!-- Models Tab -->
            <TabItem Header="Models" Style="{StaticResource TabItemStyle}">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <StackPanel Margin="20">
                        <TextBlock Text="AI Models Configuration" Style="{StaticResource SectionHeaderStyle}"/>
                        
                        <!-- Active Model Section -->
                        <GroupBox Header="Active Model" Margin="0,10">
                            <Grid Margin="10">
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                
                                <TextBlock Grid.Row="0" Grid.Column="0" Text="Current Model:" VerticalAlignment="Center" Margin="0,0,10,0"/>
                                <ComboBox Grid.Row="0" Grid.Column="1" Name="ActiveModelComboBox" DisplayMemberPath="Name" SelectedValuePath="Id"/>
                                <Button Grid.Row="0" Grid.Column="2" Content="Test Connection" Style="{StaticResource ConfigButtonStyle}" Click="TestActiveModelButton_Click"/>
                                
                                <CheckBox Grid.Row="1" Grid.ColumnSpan="3" Name="MultiModelCheckBox" Content="Enable multi-model support (advanced)" Margin="0,10,0,0"/>
                            </Grid>
                        </GroupBox>

                        <!-- Local Models Section -->
                        <GroupBox Header="Local Models" Margin="0,10">
                            <Grid Margin="10">
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="200"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>
                                
                                <TextBlock Grid.Row="0" Text="Configure local AI models (Ollama, LM Studio, etc.)" Margin="0,0,0,10"/>
                                
                                <DataGrid Grid.Row="1" Name="LocalModelsDataGrid" AutoGenerateColumns="False" CanUserAddRows="False">
                                    <DataGrid.Columns>
                                        <DataGridTextColumn Header="Name" Binding="{Binding Name}" Width="*"/>
                                        <DataGridTextColumn Header="Provider" Binding="{Binding Provider}" Width="100"/>
                                        <DataGridTextColumn Header="Endpoint" Binding="{Binding Endpoint}" Width="200"/>
                                        <DataGridCheckBoxColumn Header="Available" Binding="{Binding IsAvailable}" Width="80"/>
                                        <DataGridTemplateColumn Header="Actions" Width="100">
                                            <DataGridTemplateColumn.CellTemplate>
                                                <DataTemplate>
                                                    <Button Content="Test" Style="{StaticResource ConfigButtonStyle}" Click="TestLocalModelButton_Click"/>
                                                </DataTemplate>
                                            </DataGridTemplateColumn.CellTemplate>
                                        </DataGridTemplateColumn>
                                    </DataGrid.Columns>
                                </DataGrid>
                                
                                <StackPanel Grid.Row="2" Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,10,0,0">
                                    <Button Content="Add Local Model" Style="{StaticResource ConfigButtonStyle}" Click="AddLocalModelButton_Click"/>
                                    <Button Content="Remove Selected" Style="{StaticResource ConfigButtonStyle}" Click="RemoveLocalModelButton_Click"/>
                                    <Button Content="Auto-Discover" Style="{StaticResource ConfigButtonStyle}" Click="AutoDiscoverModelsButton_Click"/>
                                </StackPanel>
                            </Grid>
                        </GroupBox>

                        <!-- Remote Models Section -->
                        <GroupBox Header="Remote Models" Margin="0,10">
                            <Grid Margin="10">
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="200"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>
                                
                                <TextBlock Grid.Row="0" Text="Configure remote AI models (OpenAI, Anthropic, etc.)" Margin="0,0,0,10"/>
                                
                                <DataGrid Grid.Row="1" Name="RemoteModelsDataGrid" AutoGenerateColumns="False" CanUserAddRows="False">
                                    <DataGrid.Columns>
                                        <DataGridTextColumn Header="Name" Binding="{Binding Name}" Width="*"/>
                                        <DataGridTextColumn Header="Provider" Binding="{Binding Provider}" Width="100"/>
                                        <DataGridTextColumn Header="Model" Binding="{Binding ModelName}" Width="150"/>
                                        <DataGridCheckBoxColumn Header="Available" Binding="{Binding IsAvailable}" Width="80"/>
                                        <DataGridTemplateColumn Header="Actions" Width="100">
                                            <DataGridTemplateColumn.CellTemplate>
                                                <DataTemplate>
                                                    <Button Content="Test" Style="{StaticResource ConfigButtonStyle}" Click="TestRemoteModelButton_Click"/>
                                                </DataTemplate>
                                            </DataGridTemplateColumn.CellTemplate>
                                        </DataGridTemplateColumn>
                                    </DataGrid.Columns>
                                </DataGrid>
                                
                                <StackPanel Grid.Row="2" Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,10,0,0">
                                    <Button Content="Add Remote Model" Style="{StaticResource ConfigButtonStyle}" Click="AddRemoteModelButton_Click"/>
                                    <Button Content="Remove Selected" Style="{StaticResource ConfigButtonStyle}" Click="RemoveRemoteModelButton_Click"/>
                                </StackPanel>
                            </Grid>
                        </GroupBox>
                    </StackPanel>
                </ScrollViewer>
            </TabItem>

            <!-- MCP Tab -->
            <TabItem Header="MCP Servers" Style="{StaticResource TabItemStyle}">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <StackPanel Margin="20">
                        <TextBlock Text="Model Control Protocol (MCP) Configuration" Style="{StaticResource SectionHeaderStyle}"/>
                        
                        <TextBlock Text="Configure MCP servers for enhanced AI capabilities and tool access." 
                                  TextWrapping="Wrap" 
                                  Margin="0,0,0,20"
                                  Foreground="Gray"/>

                        <!-- MCP Servers List -->
                        <GroupBox Header="MCP Servers" Margin="0,10">
                            <Grid Margin="10">
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="250"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>
                                
                                <DataGrid Grid.Row="0" Name="MCPServersDataGrid" AutoGenerateColumns="False" CanUserAddRows="False">
                                    <DataGrid.Columns>
                                        <DataGridTextColumn Header="Name" Binding="{Binding Name}" Width="*"/>
                                        <DataGridTextColumn Header="Type" Binding="{Binding Type}" Width="80"/>
                                        <DataGridTextColumn Header="Endpoint" Binding="{Binding Endpoint}" Width="200"/>
                                        <DataGridCheckBoxColumn Header="Connected" Binding="{Binding IsConnected}" Width="80"/>
                                        <DataGridTemplateColumn Header="Actions" Width="120">
                                            <DataGridTemplateColumn.CellTemplate>
                                                <DataTemplate>
                                                    <StackPanel Orientation="Horizontal">
                                                        <Button Content="Test" Style="{StaticResource ConfigButtonStyle}" Click="TestMCPServerButton_Click" Margin="2"/>
                                                        <Button Content="Connect" Style="{StaticResource ConfigButtonStyle}" Click="ConnectMCPServerButton_Click" Margin="2"/>
                                                    </StackPanel>
                                                </DataTemplate>
                                            </DataGridTemplateColumn.CellTemplate>
                                        </DataGridTemplateColumn>
                                    </DataGrid.Columns>
                                </DataGrid>
                                
                                <StackPanel Grid.Row="1" Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,10,0,0">
                                    <Button Content="Add Local MCP" Style="{StaticResource ConfigButtonStyle}" Click="AddLocalMCPButton_Click"/>
                                    <Button Content="Add Remote MCP" Style="{StaticResource ConfigButtonStyle}" Click="AddRemoteMCPButton_Click"/>
                                    <Button Content="Remove Selected" Style="{StaticResource ConfigButtonStyle}" Click="RemoveMCPServerButton_Click"/>
                                    <Button Content="Auto-Discover" Style="{StaticResource ConfigButtonStyle}" Click="AutoDiscoverMCPButton_Click"/>
                                </StackPanel>
                            </Grid>
                        </GroupBox>
                    </StackPanel>
                </ScrollViewer>
            </TabItem>

            <!-- RAG Tab -->
            <TabItem Header="RAG Configuration" Style="{StaticResource TabItemStyle}">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <StackPanel Margin="20">
                        <TextBlock Text="Retrieval-Augmented Generation (RAG) Configuration" Style="{StaticResource SectionHeaderStyle}"/>
                        
                        <TextBlock Text="Configure knowledge bases and vector stores for contextual AI responses." 
                                  TextWrapping="Wrap" 
                                  Margin="0,0,0,20"
                                  Foreground="Gray"/>

                        <!-- RAG Settings -->
                        <GroupBox Header="RAG Settings" Margin="0,10">
                            <Grid Margin="10">
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                
                                <CheckBox Grid.Row="0" Grid.ColumnSpan="2" Name="EnableRAGCheckBox" Content="Enable RAG functionality" Margin="0,5"/>
                                
                                <TextBlock Grid.Row="1" Grid.Column="0" Text="Max Results:" VerticalAlignment="Center" Margin="0,5,10,5"/>
                                <Slider Grid.Row="1" Grid.Column="1" Name="MaxResultsSlider" Minimum="1" Maximum="20" Value="10" TickFrequency="1" IsSnapToTickEnabled="True" Margin="0,5"/>
                                
                                <TextBlock Grid.Row="2" Grid.Column="0" Text="Similarity Threshold:" VerticalAlignment="Center" Margin="0,5,10,5"/>
                                <Slider Grid.Row="2" Grid.Column="1" Name="SimilarityThresholdSlider" Minimum="0.1" Maximum="1.0" Value="0.7" TickFrequency="0.1" Margin="0,5"/>
                            </Grid>
                        </GroupBox>

                        <!-- Local RAG Configuration -->
                        <GroupBox Header="Local Knowledge Base" Margin="0,10">
                            <Grid Margin="10">
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                
                                <TextBlock Grid.Row="0" Grid.Column="0" Text="Vector Store:" VerticalAlignment="Center" Margin="0,5,10,5"/>
                                <ComboBox Grid.Row="0" Grid.Column="1" Name="VectorStoreComboBox" Margin="0,5">
                                    <ComboBoxItem Content="Simple Text Search" IsSelected="True"/>
                                    <ComboBoxItem Content="SQLite Vector"/>
                                    <ComboBoxItem Content="Chroma"/>
                                </ComboBox>
                                
                                <TextBlock Grid.Row="1" Grid.Column="0" Text="Index Path:" VerticalAlignment="Center" Margin="0,5,10,5"/>
                                <TextBox Grid.Row="1" Grid.Column="1" Name="IndexPathTextBox" Margin="0,5"/>
                                <Button Grid.Row="1" Grid.Column="2" Content="Browse" Style="{StaticResource ConfigButtonStyle}" Click="BrowseIndexPathButton_Click"/>
                                
                                <TextBlock Grid.Row="2" Grid.Column="0" Text="Status:" VerticalAlignment="Center" Margin="0,5,10,5"/>
                                <TextBlock Grid.Row="2" Grid.Column="1" Name="IndexStatusTextBlock" Text="Ready" Margin="0,5" Foreground="Green"/>
                                
                                <StackPanel Grid.Row="3" Grid.ColumnSpan="3" Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,10,0,0">
                                    <Button Content="Index Workspace" Style="{StaticResource ConfigButtonStyle}" Click="IndexWorkspaceButton_Click"/>
                                    <Button Content="Clear Index" Style="{StaticResource ConfigButtonStyle}" Click="ClearIndexButton_Click"/>
                                    <Button Content="View Stats" Style="{StaticResource ConfigButtonStyle}" Click="ViewIndexStatsButton_Click"/>
                                </StackPanel>
                            </Grid>
                        </GroupBox>

                        <!-- Remote RAG Configuration -->
                        <GroupBox Header="Remote Vector Database" Margin="0,10">
                            <Grid Margin="10">
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                
                                <TextBlock Grid.Row="0" Grid.Column="0" Text="Provider:" VerticalAlignment="Center" Margin="0,5,10,5"/>
                                <ComboBox Grid.Row="0" Grid.Column="1" Name="RemoteRAGProviderComboBox" Margin="0,5">
                                    <ComboBoxItem Content="Pinecone"/>
                                    <ComboBoxItem Content="Qdrant"/>
                                    <ComboBoxItem Content="Weaviate"/>
                                    <ComboBoxItem Content="Custom"/>
                                </ComboBox>
                                
                                <TextBlock Grid.Row="1" Grid.Column="0" Text="Endpoint:" VerticalAlignment="Center" Margin="0,5,10,5"/>
                                <TextBox Grid.Row="1" Grid.Column="1" Name="RemoteRAGEndpointTextBox" Margin="0,5"/>
                                
                                <TextBlock Grid.Row="2" Grid.Column="0" Text="API Key:" VerticalAlignment="Center" Margin="0,5,10,5"/>
                                <PasswordBox Grid.Row="2" Grid.Column="1" Name="RemoteRAGApiKeyBox" Margin="0,5"/>
                                
                                <TextBlock Grid.Row="3" Grid.Column="0" Text="Index Name:" VerticalAlignment="Center" Margin="0,5,10,5"/>
                                <TextBox Grid.Row="3" Grid.Column="1" Name="RemoteRAGIndexNameTextBox" Margin="0,5"/>
                                
                                <StackPanel Grid.Row="4" Grid.ColumnSpan="3" Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,10,0,0">
                                    <Button Content="Test Connection" Style="{StaticResource ConfigButtonStyle}" Click="TestRemoteRAGButton_Click"/>
                                    <Button Content="Sync with Remote" Style="{StaticResource ConfigButtonStyle}" Click="SyncRemoteRAGButton_Click"/>
                                </StackPanel>
                            </Grid>
                        </GroupBox>
                    </StackPanel>
                </ScrollViewer>
            </TabItem>

            <!-- General Settings Tab -->
            <TabItem Header="General" Style="{StaticResource TabItemStyle}">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <StackPanel Margin="20">
                        <TextBlock Text="General Settings" Style="{StaticResource SectionHeaderStyle}"/>
                        
                        <!-- Preferences -->
                        <GroupBox Header="Preferences" Margin="0,10">
                            <Grid Margin="10">
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                
                                <TextBlock Grid.Row="0" Grid.Column="0" Text="Theme:" VerticalAlignment="Center" Margin="0,5,10,5"/>
                                <ComboBox Grid.Row="0" Grid.Column="1" Name="ThemeComboBox" Margin="0,5">
                                    <ComboBoxItem Content="Auto (Follow VS Theme)" IsSelected="True"/>
                                    <ComboBoxItem Content="Light"/>
                                    <ComboBoxItem Content="Dark"/>
                                </ComboBox>
                                
                                <TextBlock Grid.Row="1" Grid.Column="0" Text="Privacy Level:" VerticalAlignment="Center" Margin="0,5,10,5"/>
                                <ComboBox Grid.Row="1" Grid.Column="1" Name="PrivacyLevelComboBox" Margin="0,5">
                                    <ComboBoxItem Content="Local Only"/>
                                    <ComboBoxItem Content="Balanced" IsSelected="True"/>
                                    <ComboBoxItem Content="Cloud Enhanced"/>
                                </ComboBox>
                                
                                <CheckBox Grid.Row="2" Grid.ColumnSpan="2" Name="AutoUpdatesCheckBox" Content="Enable automatic updates" Margin="0,10" IsChecked="True"/>
                                <CheckBox Grid.Row="3" Grid.ColumnSpan="2" Name="TelemetryCheckBox" Content="Send anonymous usage data to help improve A3sist" Margin="0,5"/>
                            </Grid>
                        </GroupBox>

                        <!-- Performance -->
                        <GroupBox Header="Performance" Margin="0,10">
                            <Grid Margin="10">
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                
                                <TextBlock Grid.Row="0" Grid.Column="0" Text="Max Tokens:" VerticalAlignment="Center" Margin="0,5,10,5"/>
                                <Slider Grid.Row="0" Grid.Column="1" Name="MaxTokensSlider" Minimum="512" Maximum="8192" Value="2048" TickFrequency="512" IsSnapToTickEnabled="True" Margin="0,5"/>
                                
                                <TextBlock Grid.Row="1" Grid.Column="0" Text="Temperature:" VerticalAlignment="Center" Margin="0,5,10,5"/>
                                <Slider Grid.Row="1" Grid.Column="1" Name="TemperatureSlider" Minimum="0.0" Maximum="2.0" Value="0.7" TickFrequency="0.1" Margin="0,5"/>
                                
                                <CheckBox Grid.Row="2" Grid.ColumnSpan="2" Name="FallbackEnabledCheckBox" Content="Enable fallback to secondary models" Margin="0,10" IsChecked="True"/>
                            </Grid>
                        </GroupBox>
                    </StackPanel>
                </ScrollViewer>
            </TabItem>
        </TabControl>

        <!-- Button panel -->
        <Border Grid.Row="1" Background="#F8F8F8" BorderBrush="#E1E1E1" BorderThickness="0,1,0,0" Padding="10">
            <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                <Button Content="Import Settings" Style="{StaticResource ConfigButtonStyle}" Click="ImportSettingsButton_Click"/>
                <Button Content="Export Settings" Style="{StaticResource ConfigButtonStyle}" Click="ExportSettingsButton_Click"/>
                <Button Content="Reset to Defaults" Style="{StaticResource ConfigButtonStyle}" Click="ResetToDefaultsButton_Click"/>
                <Button Content="Cancel" IsCancel="True" Style="{StaticResource ConfigButtonStyle}"/>
                <Button Content="OK" IsDefault="True" Style="{StaticResource ConfigButtonStyle}" Click="OKButton_Click"/>
            </StackPanel>
        </Border>
    </Grid>
</Window>